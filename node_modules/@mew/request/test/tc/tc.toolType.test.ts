import {AuthData, Mc} from "../../src/ms/mc";
import axios from "axios";
import {Tc} from "../../src/main";
import * as _ from "lodash"
const baseURL = 'https://api.mew-iot.cn'

let service = axios.create({
    baseURL ,
    timeout: 10000
})
let authData:AuthData
let tc

describe('tc', () => {
    beforeEach(async () => {
        const mc = Mc(service)
        const res = await mc.getAuth({username: 'admin', password: '111111'})
        authData = res.data
        const access_token = authData.access_token
        service = axios.create({
            baseURL,
            // adapter: axiosAdapterUniapp as AxiosAdapter,
            timeout: 10000,
            headers:{
                'Authorization': 'Bearer ' + access_token
            }
        })
        tc = Tc(service)
    })

    test('获取级联数据', async () => {
        const res = await tc.type.select({})
        // console.log(res)
        expect(res.code).toBe(0)
        expect(res.msg).toBe('success')
        const result = _.groupBy(res.data,'type')
        const arr:any=[]
        _.map(result,(items,type)=>{
            console.log(38,items,type)
            const children:any[] = []
            items.forEach((item:any)=>{
                children.push({
                    value: item.id.toString(),
                    label: item.kind
                })
            })
            arr.push({
                value: type,
                label: type,
                children
            })
        })
        console.log(45, arr)
    }, 2000)

})

function groupBy( array , id ) {
    let groups = {};
    array.forEach( function( o ) {
        let group = JSON.stringify( o[id] );
        groups[group] = groups[group] || [];
        groups[group].push( o );
    });
    return Object.values(groups);
}
