import axios from "axios";
import {Mc} from "../../src/ms/mc";

const service = axios.create({
    baseURL: 'https://api.mew-iot.cn',
    // adapter: axiosAdapterUniapp as AxiosAdapter,
    timeout: 10000
})
const mc = Mc(service)

let AccessToken=''
beforeAll(async()=>{
    const res=await mc.getAuth({username:'admin',password:'111111'})
    // console.log(res)
    expect(res.code).toBe(0)
    // expect(res.msg).toBe('success')
    expect(res.data.expiration).toBe(3600)
    AccessToken=res.data.access_token
})

describe('manger',()=>{

    test('manager select', async() => {
        const res = await mc.manager.select({id: 1})
        // console.log(res)
        expect(res.code).toBe(0)
        expect(res.msg).toBe('success')
        // 第一个用户名必须为admin
        expect(res.data[0].username).toBe('admin')
    },2000)
})

describe('role_access',()=>{
    beforeAll(async()=>{

    })

    test('app /mc/app/updateBatch', async() => {
        const mc = Mc(service)
        const json = {roleId: 19, accessIdArr: [7]}
        const res = await mc.updateRoleAccessBatch(json)
        console.log(res)
        expect(res.code).toBe(0)
        expect(res.msg).toBe('success')
        // expect(res.data.expireIn).toBe(7200)
        // expect(res.data.expireAt).toBeGreaterThan(0)
        // expect(res.data.accessToken).not.toBe('')
    },2000)
})

