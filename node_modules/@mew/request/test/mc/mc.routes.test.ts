import {Access, Mc, RoleAccess} from "../../src/ms/mc";
import { RouteConfig } from 'vue-router'
import axios from "axios";
const service = axios.create({
    baseURL: 'https://api.mew-iot.cn',
    // adapter: axiosAdapterUniapp as AxiosAdapter,
    timeout: 10000
})
const mc = Mc(service)

describe('mc.routes', () => {
    let roleId=11
    test(`roleId:${roleId},getAccessByRole`, async () => {
        const accesses = await mc.getAccessByRole(11)
        // console.log(11,accesses)
        // console.log(12,accesses[0])
        expect(accesses.length).toBe(3)
        const res=Access2Route(accesses[1])
        // console.log(16,res)
    }, 2000)
    // roleId=1
    // test(`roleId:${roleId},getAccessByRole`, async () => {
    //     const accesses = await mc.getAccessByRole(1)
    //     // console.log(17,accesses)
    //     console.log(18,accesses[0])
    //     console.log(19,accesses[1])
    //     console.log(20,accesses[2])
    //     console.log(21,accesses[3])
    //     console.log(22,accesses[4])
    //     expect(accesses.length).toBe(8)
    // }, 2000)
})

let Layout;
function Access2Route(access:Access){
    // console.log(33,access.children)
    // 二级菜单
    const children:RouteConfig[] = []
    access.children.forEach(item2=>{
        const child:RouteConfig = {
            path: item2.url,
            name: access.url + '/' + item2.url,
            // @ts-ignore
            component: (resolve) => require([`@/views/${access.url}/${item2.url}`], resolve),
            meta: {
                title: item2.actionName,
                icon: 'form',
                roles: [],
                hidden: false
            }
        }
        children.push(child)
    })
    // 一级菜单
    const route: RouteConfig = {
        path: '/' + access.url,
        component: Layout,
        name: access.url,
        meta: {
            title: access.moduleName,
            icon: access.icon,
            roles: []
        },
        children: children
    }
    return route
}

