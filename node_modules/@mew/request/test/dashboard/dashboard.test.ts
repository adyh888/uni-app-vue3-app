import {Dashboard, Mc, Rabbit} from '../../src/main'
import axios from "axios";

const baseURL = 'http://www.mew-iot.cn:51000'

let service = axios.create({
    baseURL ,
    // adapter: axiosAdapterUniapp as AxiosAdapter,
    timeout: 10000
})
let dashboard
let rabbit

console.log(14)

describe('dashboard',()=>{
    beforeAll(async()=>{
        console.log(16)
        const mc = Mc(service)
        console.log(17)
        const res = await mc.getAuth({username: 'admin', password: '111111'})
        console.log(18)
        const access_token = res.data.access_token
        service = axios.create({
            baseURL,
            timeout: 10000,
            headers:{
                'Authorization': 'Bearer ' + access_token
            }
        })
        dashboard = Dashboard(service)
        rabbit = Rabbit(service)
    })


    test('dashboard deviceStatus', async() => {
        const json = {}
        const res = await rabbit.getClients()
        console.log(res)
        expect(res.code).toBe(0)
        expect(res.msg).toBe('success')
        expect(res.data.length).toBeGreaterThan(0)
        const arr = res.data.map(element=>element.serviceName).filter(element=>!isNaN(parseInt(element)))
        // console.log(23, arr)
    },2000)

    test('dashboard toolSituation', async() => {
        const json = {}
        const res = await dashboard.toolSituation(json)
        console.log(res)
        expect(res.code).toBe(0)
        expect(res.msg).toBe('success')
        expect(res.data.length).toBeGreaterThan(0)
    },2000)

    test('dashboard toolTopTen', async() => {
        const json = {}
        const res = await dashboard.toolTopTen(json)
        console.log(res)
        expect(res.code).toBe(0)
        expect(res.msg).toBe('success')
        expect(res.data.length).toBeGreaterThan(0)
    },2000)

    test('dashboard toolBottomTen', async() => {
        const json = {}
        const res = await dashboard.toolBottomTen(json)
        console.log(res)
        expect(res.code).toBe(0)
        expect(res.msg).toBe('success')
        expect(res.data.length).toBeGreaterThan(0)
    },2000)

    test('dashboard toolBottomTen', async() => {
        const json = {}
        const res = await dashboard.toolBottomTen(json)
        // console.log(res)
        expect(res.code).toBe(0)
        expect(res.msg).toBe('success')
        expect(res.data.length).toBeGreaterThan(0)
    },2000)

    test('dashboard departmentFrequency', async() => {
        const json = {}
        const res = await dashboard.departmentFrequency(json)
        console.log(28,res)
        expect(res.code).toBe(0)
        expect(res.msg).toBe('success')
        expect(res.data.length).toBeGreaterThan(0)
    },2000)

    test('dashboard getTeamFrequency', async() => {
        const json = {}
        const res = await dashboard.teamFrequency(json)
        console.log(37,res)
        expect(res.code).toBe(0)
        expect(res.msg).toBe('success')
        expect(res.data.length).toBeGreaterThan(0)
    },2000)

    test('dashboard topTenUsers', async() => {
        const json = {}
        const res = await dashboard.topTenUsers(json)
        console.log(74,res)
        expect(res.code).toBe(0)
        expect(res.msg).toBe('success')
        expect(res.data.length).toBeGreaterThan(0)
    },2000)

    test('dashboard deviceStatus', async() => {
        const json = {}
        const res = await dashboard.deviceStatus(json)
        console.log(83,res)
        expect(res.code).toBe(0)
        // expect(res.msg).toBe('success')
        expect(res.data.online).toBeGreaterThanOrEqual(0)
        expect(res.data.total).toBeGreaterThan(0)
    },2000)


})
